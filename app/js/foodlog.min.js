/*!
 * app
 * @author David Wilhelm
 * @version 0.0.1
 */
var fl = fl || {};

(function () {
  'use strict';

  fl.Day = Backbone.Model.extend({
    initialize: function () {
      this.entries = new foodCollection();
    }
  });


})();
var fl = fl || {};

(function () {
  'use strict';

  // Food Item Model
  // Represents one entry in a possible list on entries on one day.

  fl.FoodItem = Backbone.Model.extend({

  });

  // TEMP METHOD - supress attempts to sync with a server.
  // Backbone.sync = function (method, model, options) {
  //   if (method === 'read') {
  //     console.log(options);
  //   }
  // };  
})();
var fl = fl || {};

(function () {
  'use strict';

  // Food List Collection
  // A collection of Food Items
  var FoodCollection = Backbone.Collection.extend({
    model: fl.FoodItem,

    url: 'js/food.json'

  });

  // Create global collection of food items.
  fl.foodCollection = new FoodCollection();
})();
var fl = fl || {};

(function () {
  'use strict';

  // Food List Collection
  // A collection of Food Items
  var Week = Backbone.Collection.extend({
    model: fl.Day,

    url: 'js/sample-data.json'

  });

  // Create global collection of food items.
  fl.week = new Week();
})();
(function () {
  'use strict';

  fl.FoodItemView = Backbone.View.extend({

    template: _.template( $('#foodItem-template').html() ),

    initialize: function () {
      this.listenTo(this.model, 'change', this.render);
      this.render();
    },

    render: function () {
      this.$el.html( this.template( this.model.toJSON() ) );
      $('#week').append(this.el);
      return this;
    },

    edit: function () {

    },

    updateOnEnter: function (e) {
      e.preventDefault();

    },

    close: function () {

    }
  });

})();
(function () {
  'use strict';

  fl.FoodItemView = Backbone.View.extend({

    tagName: 'li',

    id: function () {
      return this.model.cid;
    },

    template: _.template( $('#foodItem-template').html() ),

    initialize: function () {
      this.listenTo(this.model, 'change', this.render);
      this.render();
    },

    events: {
      'dblclick label': 'edit',
      'keypress .edit': 'updateOnEnter',
      'blur .edit':   'close'
    },    

    render: function () {
      this.$el.html( this.template( this.model.toJSON() ) );
      $('#week').append(this.el);
      return this;
    },

    edit: function () {

    },

    updateOnEnter: function (e) {
      e.preventDefault();

    },

    close: function () {

    }
  });

})();
(function ($) {
  'use strict';

  fl.foodLogView = Backbone.View.extend({

    initialize: function () {
      // Bind events.
      this.listenTo(fl.foodCollection, 'add', this.addOne);
      this.listenTo(fl.foodCollection, 'reset', this.addAll);

      // Retrieve stored data.
      fl.foodCollection.fetch();
    },

    addOne: function (food) {
      // Add one item to the food list.
      var view = new fl.FoodItemView({
        model: food 
      });
      view.render();  
    },

    addAll: function (food) {
      // Create an html list from a whole collection.
      fl.foodCollection.each(this.addOne, this);
    }

  });
  
})(jQuery);
(function () {
  'use strict';

  // Set up URL routes for app.
  var FoodLogRouter = Backbone.Router.extend({
    routes: {
      '*firstDayOfWeek': 'newWeekView'
    },

    newWeekView: function (param) {
      
    }    
  });

  fl.foodLogRouter = new FoodLogRouter();

  Backbone.history.start();
})();
var fl = fl || {};
var ENTER_KEY = 13;

$(function () {
  'use strict';

  // Start the app.
  new fl.foodLogView();

});